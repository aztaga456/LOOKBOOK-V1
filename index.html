<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Product Showcase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f3f4f6;
        }
        .upload-box {
            border: 2px dashed #4b5563;
            background-color: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .upload-box:hover {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }
        .active-tab {
            background-color: #3b82f6;
            color: white;
        }
        .inactive-tab {
            background-color: #374151;
            color: #d1d5db;
        }
        .custom-select {
            background-color: #374151;
            border-color: #4b5563;
        }
        .btn-primary {
            background-color: #3b82f6;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .loader {
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .modal-bg {
            background-color: rgba(0,0,0,0.7);
        }
        .generated-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
        }
        .generated-image-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.7);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.75rem;
        }
        .generated-image-container:hover .generated-image-overlay {
            opacity: 1;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center pb-6 border-b border-gray-700">
            <div class="flex items-center gap-3">
                 <svg class="w-8 h-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" />
                </svg>
                <h1 class="text-2xl font-bold text-white">AI Product Showcase</h1>
            </div>
            <p class="text-sm text-gray-400">Buat kampanye afiliasi dalam hitungan detik.</p>
        </header>

        <main class="grid md:grid-cols-[400px_1fr] gap-8 mt-8">
            <!-- Left Panel: Controls -->
            <div class="bg-gray-800 rounded-lg p-6 flex flex-col gap-6 h-fit">
                <!-- 1. Generation Mode -->
                <div>
                    <h2 class="text-lg font-semibold mb-3">Pilih Mode Generasi</h2>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="lookbookBtn" class="py-2.5 px-4 rounded-md text-sm font-medium active-tab">Lookbook</button>
                        <button id="brollBtn" class="py-2.5 px-4 rounded-md text-sm font-medium inactive-tab">B-roll</button>
                    </div>
                </div>

                <!-- Lookbook Controls -->
                <div id="lookbookControls" class="flex flex-col gap-6">
                    <!-- Upload Model -->
                    <div>
                        <h3 class="font-medium mb-2">1. Unggah Model</h3>
                        <div id="modelUploadBox" class="upload-box rounded-lg p-4 text-center cursor-pointer h-48 flex items-center justify-center">
                            <div id="modelUploadPlaceholder">
                                <svg class="w-10 h-10 mx-auto text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" /></svg>
                                <p class="text-sm text-gray-400 mt-2">Unggah foto orang</p>
                            </div>
                            <div id="modelPreviewContainer" class="hidden relative w-full h-full">
                                <img id="modelPreview" class="w-full h-full object-contain rounded-md">
                                <button id="removeModelBtn" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold">&times;</button>
                            </div>
                        </div>
                        <input type="file" id="modelInput" class="hidden" accept="image/*">
                    </div>
                    <!-- Upload Product -->
                    <div>
                        <h3 class="font-medium mb-2">2. Unggah Produk</h3>
                         <div id="productUploadBoxLookbook" class="upload-box rounded-lg p-4 text-center cursor-pointer h-48 flex items-center justify-center">
                            <div id="productUploadPlaceholderLookbook">
                                <svg class="w-10 h-10 mx-auto text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>
                                <p class="text-sm text-gray-400 mt-2">Pakaian, tas, sepatu, dll.</p>
                            </div>
                             <div id="productPreviewContainerLookbook" class="hidden relative w-full h-full">
                                <img id="productPreviewLookbook" class="w-full h-full object-contain rounded-md">
                                <button id="removeProductBtnLookbook" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold">&times;</button>
                            </div>
                        </div>
                        <input type="file" id="productInputLookbook" class="hidden" accept="image/*">
                    </div>
                </div>

                <!-- B-roll Controls -->
                <div id="brollControls" class="hidden flex-col gap-6">
                    <!-- Upload Product -->
                    <div>
                        <h3 class="font-medium mb-2">1. Unggah Produk</h3>
                        <div id="productUploadBoxBroll" class="upload-box rounded-lg p-4 text-center cursor-pointer h-48 flex items-center justify-center">
                            <div id="productUploadPlaceholderBroll">
                                <svg class="w-10 h-10 mx-auto text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>
                                <p class="text-sm text-gray-400 mt-2">Pakaian, tas, sepatu, dll.</p>
                            </div>
                            <div id="productPreviewContainerBroll" class="hidden relative w-full h-full">
                                <img id="productPreviewBroll" class="w-full h-full object-contain rounded-md">
                                <button id="removeProductBtnBroll" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold">&times;</button>
                            </div>
                        </div>
                        <input type="file" id="productInputBroll" class="hidden" accept="image/*">
                    </div>
                </div>

                <!-- 3. Customize Look -->
                <div>
                    <h3 class="font-medium mb-2" id="customizeTitle">3. Kustomisasi Tampilan</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="themeSelect" class="block text-sm font-medium text-gray-300 mb-1">Tema Pemotretan</label>
                            <select id="themeSelect" class="w-full rounded-md custom-select text-sm p-2">
                                <option value="random" selected>Random (Default)</option>
                                <option value="Studio Profesional">Studio Profesional</option>
                                <option value="Gaya Hidup Perkotaan">Gaya Hidup Perkotaan</option>
                                <option value="Alam Terbuka">Alam Terbuka</option>
                                <option value="Interior Minimalis">Interior Minimalis</option>
                                <option value="Kafe Nyaman">Kafe Nyaman</option>
                            </select>
                        </div>
                        <div>
                            <label for="lightingSelect" class="block text-sm font-medium text-gray-300 mb-1">Gaya Pencahayaan</label>
                            <select id="lightingSelect" class="w-full rounded-md custom-select text-sm p-2">
                                <option value="random" selected>Random (Default)</option>
                                <option value="Pencahayaan Studio">Pencahayaan Studio</option>
                                <option value="Cahaya Alami">Cahaya Alami</option>
                                <option value="Cahaya Dramatis">Cahaya Dramatis</option>
                                <option value="Cahaya Lembut">Cahaya Lembut</option>
                                <option value="Golden Hour">Golden Hour</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button id="generateBtn" class="w-full btn-primary text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2">
                    <span id="generateBtnText">Buat Lookbook</span>
                    <div id="generateLoader" class="hidden loader ease-linear rounded-full border-2 border-t-2 border-gray-200 h-5 w-5"></div>
                </button>
                 <div id="errorMessage" class="text-red-400 text-sm text-center hidden"></div>
            </div>

            <!-- Right Panel: Results -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-bold mb-4" id="resultsTitle">Your Fashion Lookbook!</h2>
                <div id="resultsGrid" class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Placeholder -->
                    <div id="resultsPlaceholder" class="col-span-full text-center py-20 text-gray-500">
                        <svg class="w-16 h-16 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Z" /></svg>
                        <p class="mt-4">Gambar yang Anda hasilkan akan muncul di sini.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Preview -->
    <div id="previewModal" class="fixed inset-0 z-50 items-center justify-center hidden modal-bg p-4">
        <div class="bg-gray-800 rounded-lg p-4 max-w-3xl max-h-[90vh] relative">
            <button id="closeModalBtn" class="absolute -top-3 -right-3 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-lg">&times;</button>
            <img id="modalImage" src="" alt="Image Preview" class="w-full h-full object-contain rounded-md" style="max-height: 80vh;">
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const lookbookBtn = document.getElementById('lookbookBtn');
        const brollBtn = document.getElementById('brollBtn');
        const lookbookControls = document.getElementById('lookbookControls');
        const brollControls = document.getElementById('brollControls');
        const customizeTitle = document.getElementById('customizeTitle');
        const resultsTitle = document.getElementById('resultsTitle');
        const generateBtn = document.getElementById('generateBtn');
        const generateBtnText = document.getElementById('generateBtnText');
        const generateLoader = document.getElementById('generateLoader');
        const resultsGrid = document.getElementById('resultsGrid');
        const resultsPlaceholder = document.getElementById('resultsPlaceholder');
        const errorMessage = document.getElementById('errorMessage');
        const previewModal = document.getElementById('previewModal');
        const modalImage = document.getElementById('modalImage');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        // --- State ---
        let currentMode = 'lookbook'; // 'lookbook' or 'b-roll'
        let modelImageBase64 = null;
        let productImageBase64 = null;

        // --- Image Upload Handling ---
        function setupUpload(inputId, boxId, placeholderId, previewContainerId, previewId, removeBtnId, onImageSet) {
            const input = document.getElementById(inputId);
            const box = document.getElementById(boxId);
            const placeholder = document.getElementById(placeholderId);
            const previewContainer = document.getElementById(previewContainerId);
            const preview = document.getElementById(previewId);
            const removeBtn = document.getElementById(removeBtnId);

            box.addEventListener('click', () => input.click());
            
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const base64String = event.target.result;
                        preview.src = base64String;
                        placeholder.classList.add('hidden');
                        previewContainer.classList.remove('hidden');
                        onImageSet(base64String);
                    };
                    reader.readAsDataURL(file);
                }
            });

            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                input.value = ''; // Reset file input
                preview.src = '';
                placeholder.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                onImageSet(null);
            });
        }

        setupUpload(
            'modelInput', 'modelUploadBox', 'modelUploadPlaceholder', 
            'modelPreviewContainer', 'modelPreview', 'removeModelBtn', 
            (base64) => { modelImageBase64 = base64; }
        );

        const setProductImage = (base64) => { productImageBase64 = base64; };

        setupUpload(
            'productInputLookbook', 'productUploadBoxLookbook', 'productUploadPlaceholderLookbook',
            'productPreviewContainerLookbook', 'productPreviewLookbook', 'removeProductBtnLookbook',
            setProductImage
        );

        setupUpload(
            'productInputBroll', 'productUploadBoxBroll', 'productUploadPlaceholderBroll',
            'productPreviewContainerBroll', 'productPreviewBroll', 'removeProductBtnBroll',
            setProductImage
        );


        // --- Mode Switching ---
        function switchMode(mode) {
            currentMode = mode;
            if (mode === 'lookbook') {
                lookbookBtn.classList.replace('inactive-tab', 'active-tab');
                brollBtn.classList.replace('active-tab', 'inactive-tab');
                lookbookControls.classList.remove('hidden');
                brollControls.classList.add('hidden');
                customizeTitle.textContent = "3. Kustomisasi Tampilan";
                resultsTitle.textContent = "Your Fashion Lookbook!";
                generateBtnText.textContent = "Buat Lookbook";
            } else { // b-roll
                brollBtn.classList.replace('inactive-tab', 'active-tab');
                lookbookBtn.classList.replace('active-tab', 'inactive-tab');
                brollControls.classList.remove('hidden');
                lookbookControls.classList.add('hidden');
                customizeTitle.textContent = "2. Kustomisasi Tampilan";
                resultsTitle.textContent = "Your Product B-roll!";
                generateBtnText.textContent = "Buat B-roll";
            }
             // Reset images when switching modes to avoid confusion
            modelImageBase64 = null;
            productImageBase64 = null;
            document.getElementById('removeModelBtn').click();
            document.getElementById('removeProductBtnLookbook').click();
            document.getElementById('removeProductBtnBroll').click();
        }

        lookbookBtn.addEventListener('click', () => switchMode('lookbook'));
        brollBtn.addEventListener('click', () => switchMode('b-roll'));

        // --- Generation Logic ---
        generateBtn.addEventListener('click', async () => {
             // Validation
            if (currentMode === 'lookbook' && (!modelImageBase64 || !productImageBase64)) {
                showError("Harap unggah gambar model dan produk untuk mode Lookbook.");
                return;
            }
            if (currentMode === 'b-roll' && !productImageBase64) {
                showError("Harap unggah gambar produk untuk mode B-roll.");
                return;
            }
            hideError();

            setLoading(true);
            resultsGrid.innerHTML = ''; // Clear previous results
            resultsPlaceholder.classList.add('hidden');
            
            const themeSelect = document.getElementById('themeSelect');
            const lightingSelect = document.getElementById('lightingSelect');

            let theme = themeSelect.value;
            if(theme === 'random') {
                const themes = Array.from(themeSelect.options).map(o => o.value).filter(v => v !== 'random');
                theme = themes[Math.floor(Math.random() * themes.length)];
            }
            
            let lighting = lightingSelect.value;
             if(lighting === 'random') {
                const lightings = Array.from(lightingSelect.options).map(o => o.value).filter(v => v !== 'random');
                lighting = lightings[Math.floor(Math.random() * lightings.length)];
            }
            
            const prompts = generatePrompts(theme, lighting);
            const imagePromises = prompts.map(prompt => generateImage(prompt));

            const results = await Promise.all(imagePromises);

            results.forEach(base64Data => {
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    createImageCard(imageUrl);
                }
            });
            
            if (resultsGrid.innerHTML === '') {
                 resultsPlaceholder.classList.remove('hidden');
                 resultsPlaceholder.querySelector('p').textContent = 'Maaf, gagal menghasilkan gambar. Silakan coba lagi.';
            }

            setLoading(false);
        });
        
        function generatePrompts(theme, lighting) {
            const numImages = 6;
            let basePrompts = [];

            // Instruksi spesifik untuk AI agar konsisten menggunakan referensi model dan produk
            const lookbookInstruction = "Gunakan orang dari gambar referensi model dengan ekspresi tersenyum percaya diri. Tunjukkan mereka mengenakan pakaian/produk dari gambar referensi produk. Pastikan wajah dan bentuk tubuh model konsisten. Fokusnya adalah menampilkan produk secara realistis pada model.";

            if (currentMode === 'lookbook') {
                basePrompts = [
                    `${lookbookInstruction} Pengambilan gambar sudut rendah (low-angle shot) seluruh badan, model sedang berjalan ke arah kamera. Latar: Jalanan kota. Tema: ${theme}, Pencahayaan: ${lighting}.`,
                    `${lookbookInstruction} Pengambilan gambar setinggi mata (eye-level shot) dari pinggang ke atas. Model sedang duduk di kursi, sedikit menyamping ke kamera. Latar: Interior modern. Tema: ${theme}, Pencahayaan: ${lighting}.`,
                    `${lookbookInstruction} Foto potret close-up, fokus pada wajah model dan detail kerah produk. Latar belakang studio yang lembut dan tidak fokus. Tema: ${theme}, Pencahayaan: ${lighting}.`,
                    `${lookbookInstruction} Pengambilan gambar dari atas bahu (over-the-shoulder shot), model melihat ke belakang ke arah kamera. Latar: Kafe yang nyaman. Tema: ${theme}, Pencahayaan: ${lighting}.`,
                    `${lookbookInstruction} Foto medium shot, model bersandar santai di dinding bata. Tema: ${theme}, Pencahayaan: ${lighting}.`,
                    `${lookbookInstruction} Foto profil samping (side profile shot), dari pinggang ke atas, menampilkan detail samping produk. Latar belakang outdoor yang estetik. Tema: ${theme}, Pencahayaan: ${lighting}.`
                ];
            } else { // b-roll
                basePrompts = [
                   `Sebuah poster iklan profesional untuk produk. Dramatis dan menarik perhatian. Gaya: ${theme}, Pencahayaan: ${lighting}.`,
                   `Sebuah foto yang sangat estetis dari produk di atas permukaan reflektif, menciptakan bayangan cermin yang indah. Gaya: ${theme}, Pencahayaan: ${lighting}.`,
                   `Produk disajikan dalam komposisi flat-lay kelas atas, dikelilingi oleh barang-barang mewah yang sesuai dengan tema. Dilihat dari atas. Gaya: ${theme}, Pencahayaan: ${lighting}.`,
                   `Sebuah foto makro artistik dan detail dari tekstur produk, dengan depth of field yang dangkal. Gaya: ${theme}, Pencahayaan: ${lighting}.`,
                   `Produk ditempatkan di lingkungan luar ruangan yang alami, seperti di atas batu berlumut atau di sebelah bunga yang indah, untuk menciptakan nuansa organik. Gaya: ${theme}, Pencahayaan: ${lighting}.`,
                   `Sebuah foto kreatif produk yang seolah-olah melayang di udara dengan latar belakang berwarna polos. Gaya: ${theme}, Pencahayaan: ${lighting}.`
                ];
            }
            
            // Acak urutan prompt untuk memberikan variasi lebih banyak setiap kali generate
            for (let i = basePrompts.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [basePrompts[i], basePrompts[j]] = [basePrompts[j], basePrompts[i]];
            }

            return basePrompts.slice(0, numImages);
        }

        async function generateImage(prompt) {
             const apiKey = ""; // Canvas will provide this
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            
             const modelImagePart = modelImageBase64 ? { inlineData: { mimeType: 'image/png', data: modelImageBase64.split(',')[1] } } : null;
             const productImagePart = { inlineData: { mimeType: 'image/png', data: productImageBase64.split(',')[1] } };
             
             const parts = [ { text: prompt } ];
             if (currentMode === 'lookbook' && modelImagePart) {
                 parts.push(modelImagePart, productImagePart);
             } else {
                 parts.push(productImagePart);
             }

             const payload = {
                contents: [{ parts }],
                generationConfig: { responseModalities: ['TEXT', 'IMAGE'] },
             };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    console.error("API Error:", response.status, await response.text());
                    return null;
                }
                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                return base64Data || null;
            } catch (error) {
                console.error("Fetch Error:", error);
                return null;
            }
        }
        
        function createImageCard(imageUrl) {
            const container = document.createElement('div');
            container.className = 'generated-image-container group';

            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'Generated lookbook image';
            img.className = 'w-full h-full object-cover aspect-square';

            const overlay = document.createElement('div');
            overlay.className = 'generated-image-overlay';

            const previewBtn = document.createElement('button');
            previewBtn.textContent = 'Pratinjau';
            previewBtn.className = 'bg-gray-200 text-gray-900 text-sm font-semibold px-4 py-1.5 rounded-md';
            previewBtn.onclick = () => showPreviewModal(imageUrl);
            
            const downloadBtn = document.createElement('button');
            downloadBtn.textContent = 'Unduh';
            downloadBtn.className = 'bg-blue-600 text-white text-sm font-semibold px-4 py-1.5 rounded-md';
            downloadBtn.onclick = () => downloadImage(imageUrl, 'showcase-image.png');

            overlay.appendChild(previewBtn);
            overlay.appendChild(downloadBtn);
            container.appendChild(img);
            container.appendChild(overlay);
            resultsGrid.appendChild(container);
        }

        // --- UI Helpers ---
        function setLoading(isLoading) {
            if (isLoading) {
                generateLoader.classList.remove('hidden');
                generateBtn.disabled = true;
                generateBtn.classList.add('opacity-70', 'cursor-not-allowed');
            } else {
                generateLoader.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }
        
        function showPreviewModal(imageUrl) {
            modalImage.src = imageUrl;
            previewModal.style.display = 'flex';
        }

        function hidePreviewModal() {
            previewModal.style.display = 'none';
            modalImage.src = '';
        }
        
        closeModalBtn.addEventListener('click', hidePreviewModal);
        previewModal.addEventListener('click', (e) => {
            if (e.target === previewModal) {
                hidePreviewModal();
            }
        });

        function downloadImage(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

</body>
</html>


